<?php
	header("Access-Control-Allow-Origin: *");
?>
<!DOCTYPE html>
<html>
	<head>
		<title>BloodthirstyCat SimplePaint</title>
	  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
	  <meta name="viewport" content="width=device-width, initial-scale=1">
	  
	  <script type="text/javascript" src="//code.jquery.com/jquery-1.9.1.js"></script>
		  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/downloadjs/1.4.7/download.min.js"></script>
		  
		  <style type="text/css">
			  #image{
				  margin-left: 30px;
				  margin-top: 50px;
				  border: 1px dashed black;
				  width: 560px;
				  height: 315px;
			  }

				#lol{
					position: absolute;
					top: 50%;
					left: 50%;
					margin-right: -50%;
					transform: translate(-50%, -50%);
				}

				h1,h4{
					text-align: center; 
					color: blue;
				}
		  </style>

		<script type="text/javascript">
		$(window).load(function(){

			var image = document.getElementById("image");
			var ctx = image.getContext("2d");
			ctx.fillStyle = "white";
			ctx.fillRect(0, 0, image.width, image.height);
			var mouseDown = false;
			var pioro_kolor = "black";
			var pioro_rozmiar = 3;

			image.onmousedown = function(){
				mouseDown = true;
			}
			image.onmouseup = function(){
				mouseDown = false;
			}
			image.onmousemove = function(evt){
				if(mouseDown){
					 var rect = image.getBoundingClientRect(), 
					 scaleX = image.width / rect.width,    
					 scaleY = image.height / rect.height;  
					 var x  = (evt.clientX - rect.left) * scaleX;   
					 var y  = (evt.clientY - rect.top) * scaleY;
					ctx.beginPath();
					ctx.arc(x,y, pioro_rozmiar, 0, 2*Math.PI);
					ctx.fillStyle = pioro_kolor;
					ctx.fill();
				}
			}

			var cleanit = document.getElementById("cleanit");
			cleanit.onclick = function(){
			ctx.fillStyle = "white";
			ctx.fillRect(0, 0, image.width, image.height);
			}

			var setit = document.getElementById("setit");
			setit.onclick = function(){
				var ps = document.getElementById("size").value;
				var pk = document.getElementById("color").value;
				if(ps != "" && parseInt(ps) != NaN){
					pioro_rozmiar = ps;
				}
				if(pk != ""){
					pioro_kolor = pk;
				}
			}

			
			var seturl = document.getElementById("seturl");
			seturl.addEventListener('click',function(){
				setfetch();
			});
			
			function setfetch(){
				if(document.getElementById("url") != undefined && document.getElementById("url").value != ""){
					var url = document.getElementById("url").value;
					var video = null
					var source = null;
					$.getJSON("https://you-link.herokuapp.com/index.php?url=" + url).done(function(data){
						video = document.createElement("video");
						source = document.createElement("source");
						var interval;
						video.width = 0;
						video.height = 0;
						video.style.visibility = "hidden";
						source.src = data[0].url;
						source.type = data[0].type;
						video.appendChild(source);
						document.body.appendChild(video);
						video.addEventListener('play',function(){
							interval = setInterval(function(){
								ctx.drawImage(video,0,0,image.width,image.height);
							},30)
						});
						video.addEventListener('pause',function(){
								clearInterval(interval);
						});
						video.addEventListener('stop',function(){
								clearInterval(interval);
						});
						
						var play = document.getElementById("play");
						var pause = document.getElementById("pause");
						
						play.disabled = false;
						pause.disabled = false;
						
						play.addEventListener('click',function(){
							video.play();
						});
						
						pause.addEventListener('click',function(){
							video.pause();
						});
						
						var surl = document.getElementById("seturl");
						surl.disabled = true;
						
					});
				}else{
					alert("Bad or empty URL");
				}
			}	
		});
		
		</script>
	</head>
	<body>
		  <h1>YoutubeCanvas</h1>
		  <h4>by robercik101</h4>
		<br />
		<div id="lol">
			<canvas id="image"></canvas><br /><br /><br />
			<input type="text" id="url" autocomplete="off">
			<button type="button" id="seturl">Set and Fetch</button><br />
			<button type="button" id="play" disabled>Play</button><button type="button" id="pause" disabled>Pause</button><br>
			<button type="button" id="cleanit">
			Clean it!
			</button><br />
			Pen size: <input type="text" id="size" autocomplete="off"><br />
			Pen color: <input type="text" id="color" autocomplete="off"><br />
			<button type="button" id="setit">
			Set it!
			</button>   
			<br />			
		</div>
	</body>
</html>